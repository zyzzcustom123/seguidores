<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Concluir Etapas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial, Helvetica, sans-serif;
  text-align:center;
}
.container{padding:20px}
.progress-bar{
  height:10px;
  background:#222;
  border-radius:5px;
  overflow:hidden;
  margin:20px 0;
}
#progress{
  height:100%;
  width:0%;
  background:lime;
  transition:width .4s;
}
button,a{
  display:block;
  margin:12px auto;
  padding:14px;
  border-radius:6px;
  text-decoration:none;
  font-weight:bold;
  width:100%;
  max-width:400px;
  border:none;
  cursor:pointer;
}
.visit{
  background:#007bff;
  color:#fff;
}
.confirm{
  background:#444;
  color:#fff;
  opacity:.6;
}
.confirm.active{
  background:green;
  opacity:1;
}
#download{
  display:none;
  background:green;
  color:#fff;
}
</style>
</head>

<body>
<div class="container">

<h1 id="titulo">Concluir tarefa</h1>

<div class="progress-bar">
  <div id="progress"></div>
</div>

<button class="visit" onclick="abrir()">ðŸ”— Visitar pÃ¡gina</button>
<button id="confirm" class="confirm" disabled onclick="finalizar()">âœ… JÃ¡ visitei</button>

<a id="download" target="_blank">ðŸ“¥ Baixar Agora</a>

</div>

<script>
const params = new URLSearchParams(window.location.search);

document.getElementById("titulo").textContent =
  params.get("titulo") || "Concluir tarefa";

const canalLink = params.get("canalLink");
const downloadLink = params.get("downloadLink");

let saiuEm = null;
const tempoMinimo = 10; // segundos fora da aba

const btnConfirm = document.getElementById("confirm");
const progress = document.getElementById("progress");
const download = document.getElementById("download");

function abrir(){
  if(!canalLink){
    alert("Link invÃ¡lido.");
    return;
  }

  saiuEm = Date.now();
  window.open(canalLink, "_blank");

  btnConfirm.disabled = true;
  btnConfirm.classList.remove("active");
}

document.addEventListener("visibilitychange", () => {
  if (document.visibilityState === "visible" && saiuEm) {
    const tempoFora = (Date.now() - saiuEm) / 1000;

    if (tempoFora >= tempoMinimo) {
      btnConfirm.disabled = false;
      btnConfirm.classList.add("active");
      progress.style.width = "100%";
    }
  }
});

function finalizar(){
  if(!downloadLink){
    alert("Download nÃ£o disponÃ­vel.");
    return;
  }

  download.href = downloadLink;
  download.style.display = "block";
}
</script>

</body>
</html>
